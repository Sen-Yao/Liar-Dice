# Liar Dice

这是一个基于强化学习完成的 Liar Dice 的 Agent 项目

## 游戏规则

### 基本规则

Liar Dice 是一个回合制桌面游戏，游戏玩家为 2 名及以上，所有玩家绕桌子围成一圈。按逆时针进行游戏。每位玩家始终有 5 颗、六面骰（点数 1–6）。

“整场（Match）”游戏中，每位玩家的起始罚点为 0 点，输一局会获得 1 个罚点（跳开则为乘数，参见「跳开」），罚点数越少，排名越好。在整场游戏中不会出现玩家个数、骰子个数的变动。

整场游戏由多个局（round）组成。一局游戏的定义为，从所有玩家掷骰子到某一个玩家进行「检验」的循环。

每局游戏开始时，每位玩家掷自己的五颗骰子，骰子结果**仅自己可见**。掷骰结束后，玩家按逆时针进入自己的行动回合，未处于行动回合的玩家无法进行任何操作。行动回合中，玩家必须选择其中一种动作，否则无法结束自己的回合：

- 一次合法猜测，游戏继续，进入下一个玩家的回合
- 检验（challenge）上一个玩家的猜测（如果检验，立即翻牌判定并结算本局）


特别地，当前局的首位玩家在其首回合必须以“猜测”开始（不能检验）。因为场上没有可供检测的猜测。

若是整场游戏的第一局游戏，则随机选择一位玩家来作为本局游戏的第一位玩家开始回合。否则选择上一局的输家作为第一位玩家。
#### 猜测

「**猜测**」指的是此玩家根据自己的骰子结果和对场上其他玩家的估计，公开宣告此玩家猜测某个点数在所有玩家的骰子中的**和大于等于某个值**。所有玩家都将听到并记住此猜测。

注意在本游戏中，点数为 1 的骰子可以看成是任意点数。例如 “7 个 4” 是一个猜测，它表示此玩家认为场上所有玩家手里的骰子中，点数为 4 的骰子和点数为 1 的骰子加起来共有 7 个**及以上**。

在基本规则中，猜测的点数不能为 1

猜测可用形式定义为二元组 `(count, face)`，其中：

- `count` 为正整数，即骰子的个数。上限为当前场上骰子总数，即玩家数 × 5
- `face ∈ {2,3,4,5,6}`，即骰子的点数

猜测存在大小之分。例如猜测 1 和 猜测 2 的大小定义如下（考虑对称性，仅介绍大于和等于的情况）：

- 若 `count_1 > count_2`，则猜测 1 大于猜测 2
- 若 `count_1 == count_2`：
	- 若 `face_1 > face_2`，则猜测 1 大于猜测 2
	- 若 `face_1 == face_2`，则猜测 1 等于猜测 2

每一个玩家进行猜测时，要求猜测严格大于上一个玩家。

特别地，为了防止每局游戏的早期猜测过于简单，要求当前局的第一个回合的玩家的猜测，个数 `count` 必须大于当前玩家数。比如对于一局 5 个玩家的游戏，第一个玩家的猜测应从 6 个 X 及以上开始。若该玩家在之后（本局中）再次轮到其回合，不再受该首回合限制。

只有满足以下条件的猜测才是一个合法的猜测。

- `(count, face)` 不超过定义域。
- 对于非首回合的玩家，猜测必须严格大于场上的上一个合法猜测
- 对于首回合玩家，猜测个数 `count` 必须大于当前玩家数。

若玩家做出一个不合法的猜测，则此行动无效，必须立即重新选择合法的猜测或选择对上一个玩家进行检验。

显然，若无合法更大的猜测存在，则当前玩家唯一可选动作为检验

#### 检验

「**检验**」指的是当前回合玩家对上一位玩家的猜测提出了质疑，认为其猜测不合理。当前玩家要求检验时，所有玩家均展示自己的全部骰子情况。并且检验上一位玩家的猜测的真假。

对于上一位玩家的猜测，检验全局所有玩家的骰子结果中，对应点数及点数 1 的骰子个数。

- 若骰子个数大于等于上一位玩家的猜测的个数，则猜测为真。进行检验的玩家输掉此游戏，本局结束。
- 反之猜测为假，则上一个提出猜测的玩家输掉此游戏，本局结束。

一局游戏结束后，上一局输掉的玩家作为新一局游戏的第一位玩家。每局的输家在整场游戏中的罚点数加 1（跳开则为乘数，参见「跳开」）。整场游戏可以在任意一局的结束时，根据玩家意愿结束。结束时根据每位玩家的罚点情况进行结算

### 进阶规则

#### 斋和飞

「斋」和「飞」是一种对基础猜测规则的扩展。具体来说，玩家进行猜测时，可灵活无代价地选择此次猜测适用的规则。

- 「斋」表示不再遵守「点数 1 的骰子可作为任意其他点数」的规则。特别地，在此规则下允许选择 1 作为猜测的点数。
- 「飞」表示仍遵守「点数 1 的骰子可作为任意其他点数」的规则。点数 1 仍被视为万能牌（wild），此时不允许选择 1 作为猜测的点数。

在一局游戏中，玩家可以根据场上局势来在**斋**和**飞**中灵活变化，来选择最有利于自己的猜测方式。猜测可用形式定义为三元组 `(mode, count, face)`，其中：

- `mode ∈ {飞, 斋}`
- `count` 为正整数，即骰子的个数。
- `face`，即骰子的点数。飞规则下定义域为 `{2,3,4,5,6}`，斋规则下定义域为 `{1,2,3,4,5,6}`

引入「斋」和「飞」后，猜测的大小判断同样需要更新。例如猜测 1 和 猜测 2 的大小定义如下（考虑对称性，仅介绍大于和等于的情况）：

- 若 `mode_1 == mode_2`
	- 若 `count_1 > count_2`，则猜测 1 大于猜测 2
	- 若 `count_1 == count_2`：
		- 若 `face_1 > face_2`，则猜测 1 大于猜测 2
		- 若 `face_1 == face_2`，则猜测 1 等于猜测 2
- 若 `mode_1 == '斋'` 且  `mode_2 == '飞'` 
	- 若 `2 * count_1 > count_2`，则猜测 1 大于猜测 2
	- 若 `2 * count_1 == count_2`：
		- 若 `face_1 > face_2`，则猜测 1 大于猜测 2
		- 若 `face_1 == face_2`，则猜测 1 等于猜测 2
- 若 `mode_2 == '斋'` 且  `mode_1 == '飞'` 
	- 等价地使用同样规则（即可对换位置，得到与上面类似的比较逻辑）。

其余猜测规则仍参考基础规则中的猜测。检验时，

- 若被检验的猜测为“飞”模式：计数 = 全场中等于 face 的骰子 + 全场中点数为 1 的骰子（1 为 wild）。
- 若被检验的猜测为“斋”模式：计数 = 全场中等于 face 的骰子（点数为 1 仅计入 face=1 的猜测）。

## 使用

运行游戏：

```bash
python main.py
```

可选参数：

- `--mode`: 选择 `human` 时，表示作为人类玩家与 AI 对战
- `--render`: 启用渲染显示游戏过程
- `--num_players N`: 设置玩家数量（默认为2）
- `--num_match N`: 设置局数（默认为1）

使用示例：

```bash
# AI训练模式（默认）
python main.py

# 人机对战模式
python main.py --mode human

# 4人对战（1人类+3AI）
python main.py --mode human --num_players 4

# 多场比赛
python main.py --mode human --num_match 3

# 启用详细渲染
python main.py --mode human --render
```